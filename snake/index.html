<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI Game Portal - Snake Game</title>
    <style>
        /* CSS: 게임 디자인 */
        body {
            background-color: #2c3e50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden; /* 스크롤 방지 */
        }

        #game-info {
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: bold;
        }

        /* 캔버스 테두리 및 배경 */
        canvas {
            background-color: #000;
            border: 5px solid #34495e;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .controls-hint {
            margin-top: 15px;
            color: #bdc3c7;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <script src="../navbar.js"></script>

    <div id="game-info">SCORE: <span id="score-val">0</span></div>
    
    <canvas id="snakeCanvas" width="400" height="400"></canvas>

    <div class="controls-hint">방향키를 눌러 이동하세요!</div>

    <script>
        /**
         * JS: 지렁이 게임 로직
         */
        const canvas = document.getElementById("snakeCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score-val");

        const gridSize = 20; // 한 칸의 크기
        const tileCount = canvas.width / gridSize; // 가로 세로 칸 수 (20칸)

        let score = 0;
        let dx = 0; // 수평 속도
        let dy = 0; // 수직 속도
        
        // 지렁이 몸통 (좌표 배열)
        let snake = [
            {x: 10, y: 10}, 
            {x: 10, y: 11}, 
            {x: 10, y: 12}
        ];

        // 먹이 위치
        let foodX = 5;
        let foodY = 5;

        // 게임 루프 실행 (0.1초마다 그림)
        let gameSpeed = 100;
        let gameLoop = setInterval(draw, gameSpeed);

        // 키보드 입력 이벤트
        document.addEventListener("keydown", changeDirection);

        function draw() {
            moveSnake();

            if (checkGameOver()) {
                clearInterval(gameLoop);
                alert("게임 종료! 점수: " + score);
                location.reload(); // 페이지 새로고침으로 재시작
                return;
            }

            clearCanvas();
            drawFood();
            drawSnake();
        }

        function clearCanvas() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawSnake() {
            ctx.fillStyle = "#2ecc71"; // 지렁이 색상
            snake.forEach((part, index) => {
                // 머리는 조금 더 밝은 색으로
                if(index === 0) ctx.fillStyle = "#58d68d";
                else ctx.fillStyle = "#2ecc71";
                
                ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
            });
        }

        function moveSnake() {
            // 새로운 머리 위치 계산
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // 지렁이가 움직이고 있을 때만 (시작 전 대기 방지)
            if (dx !== 0 || dy !== 0) {
                snake.unshift(head); // 새로운 머리 추가

                // 먹이를 먹었는지 확인
                if (head.x === foodX && head.y === foodY) {
                    score += 10;
                    scoreElement.innerText = score;
                    createFood();
                } else {
                    snake.pop(); // 먹이를 안 먹었으면 꼬리 제거
                }
            }
        }

        function changeDirection(event) {
            const LEFT_KEY = 37;
            const RIGHT_KEY = 39;
            const UP_KEY = 38;
            const DOWN_KEY = 40;

            const keyPressed = event.keyCode;
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingRight = dx === 1;
            const goingLeft = dx === -1;

            // 반대 방향으로 즉시 회전하는 것을 방지
            if (keyPressed === LEFT_KEY && !goingRight) { dx = -1; dy = 0; }
            if (keyPressed === UP_KEY && !goingDown) { dx = 0; dy = -1; }
            if (keyPressed === RIGHT_KEY && !goingLeft) { dx = 1; dy = 0; }
            if (keyPressed === DOWN_KEY && !goingUp) { dx = 0; dy = 1; }
        }

        function createFood() {
            foodX = Math.floor(Math.random() * tileCount);
            foodY = Math.floor(Math.random() * tileCount);
            
            // 지렁이 몸 위에 음식이 생기지 않도록 재확인
            snake.forEach(part => {
                if (part.x === foodX && part.y === foodY) createFood();
            });
        }

        function drawFood() {
            ctx.fillStyle = "#e74c3c"; // 먹이 색상 (빨간색)
            ctx.fillRect(foodX * gridSize, foodY * gridSize, gridSize - 2, gridSize - 2);
        }

        function checkGameOver() {
            // 벽에 부딪혔는지 확인
            if (snake[0].x < 0 || snake[0].x >= tileCount || snake[0].y < 0 || snake[0].y >= tileCount) {
                return true;
            }
            // 자기 몸에 부딪혔는지 확인
            for (let i = 4; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
            }
            return false;
        }
    </script>
</body>
</html>
